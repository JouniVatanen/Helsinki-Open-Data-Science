---
  title       : Regression and model validation 
description : Data wrangling, simple regression, multiple regression, regression diagnostics


--- type:NormalExercise lang:r xp:100 skills:1  key:6e77718b66
## Reading data from the web

*Welcome to chapter1*: Regression and model validation. 

The first step of data analysis with R is reading data into R. This is done with a function. Which function and function arguments to use to do this, depends on the original format of the data. 

Conveniently in R, the same functions for reading data can usually be used weather the data is saved locally on your computer or is located behind a web URL.

After the correct function has been identified and data read into R, the data will usually be in R's `data.frame` format. A data frame's dimensions are ($n$,$d$), where $n$ is the number of rows (the observations) and $d$ the number of columns (the variables).


*** =instructions
- Read the `lrn14` data frame to memory with `read.table()`
- Use `dim()` on the data frame to look at the dimensions of the data. How many rows and colums does the data have?
- Look at the structure of the data with `str()`. 

*** =hint
- hint

*** =pre_exercise_code
```{r}

```

*** =sample_code
```{r}

# read the data into memory
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)

# look at the dimensions of the data


# look at the structure of the data


```

*** =solution
```{r}

# read the data into memory
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)

# look at the dimensions of the data
dim(lrn14)

# look at the structure of the data
str(lrn14)

```

*** =sct
```{r}

test_function("dim", args = "x",incorrect_msg = "Please use the function dim() to look at the dimensions of the data")
test_function("str", args = "object", incorrect_msg = "Please use the function str() to look at the structure of the data")

test_error()
success_msg("Good work!")
```


--- type:NormalExercise lang:r xp:100 skills:1  key:3efc4528fc
## Scaling variables

The next step is [wrangling the data](https://en.wikipedia.org/wiki/Data_wrangling) into a format that is easy to analyze. We will wrangle our data for the next few exercises. 

A neat thing about R is that may operations are *vectorized*. By this we mean that a single operation can affect all elements of a vector. This is often convenient.

The column "Attitude" in `lrn14` is a sum of 10 questions related to students attitude towards statistics, each measured on the Likert scale (1-5). Here we'll scale the combination variable back to the 1-5 scale.

*** =instructions
- Execute the example codes to see how vectorized division works
-  Use vector division to create a new column "attitude", where each observation of "Attitude" is scaled back to the original scale of the questions, by dividing it with the number of questions.

*** =hint
- hint

*** =pre_exercise_code
```{r}
# read the data into memory
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)
```

*** =sample_code
```{r}
#lrn14 is available

# divide each number in a vector
c(1,2,3,4,5) / 2

# divide each number in a column vector
lrn14$Attitude / 10

# create column 'attitude' by scaling the column "Attitude"
lrn14$attitude <- 


```

*** =solution
```{r}
# divide each number in a vector
c(1,2,3,4,5) / 2

# divide each number in a longer vector
lrn14$Attitude / 10

# create column 'attitude' by scaling the column "Attitude"
lrn14$attitude <- lrn14$Attitude / 10

```

*** =sct
```{r}

test_object("lrn14", incorrect_msg = "Please create the column 'attitude in the data frame 'lrn14' be scaling the column 'Attitude'")

test_error()
success_msg("Well done. Excellent wrangling!")
```


--- type:NormalExercise lang:r xp:100 skills:1 key:9a390d843f
## Combining variables

Our data includes many questions that can be thought to measure the same *dimension*. Here we'll combine multiple questions into combination variables. Useful functions for summation with data frames in R are

function      | description
------------- | ----------
`colSums()`   | returns a sum of each column
`rowSums()`   | returns a sum of each row
`colMeans()`  | returns the means of each column
`rowMeans()`  | return the means of each row

We'll combine the use of `rowMeans()`with the `select()` function from the **dplyr** library to average the answers of selected questions.

*** =instructions
- Access the **dplyr** library
- Execute the example codes to create the combination variables 'deep' and 'surf' as columns in `lrn14`
- Select the columns related to strategic learning from `lrn14`
- Create the combination variable 'stra' as a column in `lrn14`

*** =hint
- hint

*** =pre_exercise_code
```{r}
# read the data into memory
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)
lrn14$attitude <- lrn14$Attitude / 10
```

*** =sample_code
```{r}
# lrn14 is available

# Access the dplyr library
library(dplyr)

# questions related to deep, surface and strategic learning
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D07","D14","D22","D30")
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")

# select the columns related to deep learning and create column 'deep' by averagin
deep_columns <- select(lrn14, one_of(deep_questions))
lrn14$deep <- rowMeans(deep_columns)

# select the columns related to surface learning and create column 'surf' by averaging
surface_columns <- select(lrn14, one_of(surface_questions))
lrn14$surf <- rowMeans(surface_columns)


# select the columns related to strategic learning and create column 'stra' by averaging



```

*** =solution
```{r}
# Access the dplyr library
library(dplyr)

# questions related to deep, surface and strategic learning
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D07","D14","D22","D30")
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")

# select the columns related to deep learning and create column 'deep' by averaging
deep_columns <- select(lrn14, one_of(deep_questions))
lrn14$deep <- rowMeans(deep_columns)

# select the columns related to surface learning and create column 'surf' by averaging
surface_columns <- select(lrn14, one_of(surface_questions))
lrn14$surf <- rowMeans(surface_columns)

# select the columns related to strategic learning and create column 'stra' by averaging
strategic_columns <- select(lrn14, one_of(strategic_questions))
lrn14$stra <- rowMeans(strategic_columns)

```

*** =sct
```{r}

test_object("lrn14", incorrect_msg = "Please do not remove the example codes and create the column 'stra' in the data frame 'lrn14' by averaging the answers to strategic learning questions.")

test_error()
success_msg("Yes! You are clearly a combination of intelligence and enthusiasm!")
```


--- type:NormalExercise lang:r xp:100 skills:1  key:6acf3bcc8b
## Selecting columns

Often it is convenient to work with only a certain column or a subset of columns of a bigger data frame. There are many ways to select columns of a data frame in R. 

Here we use the already familiar `select()` function from the **dplyr** library, which is a popular library for *data wrangling*. See also the [data wrangling cheatsheet by RStudio](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf). 

*** =instructions
- Look at the dimension of `lrn14`
- Access the **dplyr** library
- Create object `keep_columns`
- Use `select()` (possibly together with `one_of()`) to create a new data frame `learning2014` with only the columns named in `keep_columns`. See the [data wrangling cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf) for help.
- Look at the structure of the new dataset


*** =hint
- hint

*** =pre_exercise_code
```{r}
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)
lrn14$attitude <- lrn14$Attitude / 10
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D07","D14","D22","D30")
lrn14$deep <- rowMeans(lrn14[, deep_questions])
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
lrn14$surf <- rowMeans(lrn14[, surface_questions])
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")
lrn14$stra <- rowMeans(lrn14[, strategic_questions])

library(dplyr)
```

*** =sample_code
```{r}
# lrn14 is available

# current dimensions of the data
dim(lrn14)

# access the dplyr library
library(dplyr)

# choose a handful of columns to keep
keep_columns <- c("gender","Age","attitude", "deep", "stra", "surf", "Points")

# select the keep_columns to create a new dataset
learning2014 <- 

# see the stucture of the new dataset


```

*** =solution
```{r}

# current dimensions of the data
dim(lrn14)

# access the dplyr library
library(dplyr)

# choose a handful of columns to keep
keep_columns <- c("gender","Age","attitude", "deep", "stra", "surf", "Points")

# select the keep_columns to create a new dataset
learning2014 <- select(lrn14, one_of(keep_columns))

# see the structure of the new dataset
str(learning2014)

```

*** =sct
```{r}
test_object("learning2014", incorrect_msg = "Please use the selected columns to create the learning2014 dataset")
test_function("str", args = "object", incorrect_msg = "Please use the `str()` function to see the structure of the learnign2014 dataset")

test_error()
success_msg("Great work! I choose you!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:b020be3ce5
## Modifying column names

Sometimes you want to rename your colums. You could do this by creating copies of the columns with new names, but you can also directly get and set the column names of a data frame, using the function `colnames()`.

**dplyr** also has a `rename()` function, which you are free to try if you wish. Remember [the cheatseet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf).

*** =instructions
- Print out the column names of `learning2014`
- Change the name of the second column to 'age'
- Change the name of 'Points' to 'points'

*** =hint
- hint

*** =pre_exercise_code
```{r}
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)
lrn14$attitude <- lrn14$Attitude / 10
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D07","D14","D22","D30")
lrn14$deep <- rowMeans(lrn14[, deep_questions])
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
lrn14$surf <- rowMeans(lrn14[, surface_questions])
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")
lrn14$stra <- rowMeans(lrn14[, strategic_questions])
learning2014 <- lrn14[, c("gender","Age","attitude", "deep", "stra", "surf", "Points")]
```

*** =sample_code
```{r}
# learning2014 is available

# print out the column names of the data
colnames(learning2014)

# change the name of the second column
colnames(learning2014)[2] <- "age"

# change the name of "Points" to "points"


# print out the new column names of the data


```

*** =solution
```{r}

# print out the column names of the data
colnames(learning2014)

# change the name of the second column
colnames(learning2014)[2] <- "age"

# change the name of "Points" to "points"
colnames(learning2014)[7] <- "points"

# print out the new column names of the data
colnames(learning2014)


```

*** =sct
```{r}


test_output_contains('c("gender","age","attitude", "deep", "stra", "surf", "points")', incorrect_msg = "Please change the name of the 'Points' column to 'points' and print out the new column names")

test_error()
success_msg("Well done!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:7955b0f30e
## Excluding observations

Often your data includes outliers or other observations which you wish to remove before further analysis. Or perhaps you simply wish to work with some subset of your data. 

In the **student2014** data the variable 'points' denotes the students exam points in a statistics course exam. If the student did not attend an exam, the value of 'points' will be zero. We will remove these observations from the data.

*** =instructions
- Access the **dplyr** library
- As an example, create object `male_students` by selecting the male students from `learning2014`
- Override `learning2014` by selecting rows where the 'points' variable is greater than zero.

*** =hint
- hint

*** =pre_exercise_code
```{r}
lrn14 <- read.table("http://www.helsinki.fi/~kvehkala/JYTmooc/JYTOPKYS3-data.txt", sep="\t", header=TRUE)
lrn14$attitude <- lrn14$Attitude / 10
deep_questions <- c("D03", "D11", "D19", "D27", "D07", "D14", "D22", "D30","D07","D14","D22","D30")
lrn14$deep <- rowMeans(lrn14[, deep_questions])
surface_questions <- c("SU02","SU10","SU18","SU26", "SU05","SU13","SU21","SU29","SU08","SU16","SU24","SU32")
lrn14$surf <- rowMeans(lrn14[, surface_questions])
strategic_questions <- c("ST01","ST09","ST17","ST25","ST04","ST12","ST20","ST28")
lrn14$stra <- rowMeans(lrn14[, strategic_questions])
learning2014 <- lrn14[, c("gender","Age","attitude", "deep", "stra", "surf", "Points")]
colnames(learning2014)[2] <- "age"
colnames(learning2014)[7] <- "points"

```

*** =sample_code
```{r}
# learning2014 is available

# access the dplyr library
library(dplyr)

# select male students
male_students <- filter(learning2014, gender == "M")

# select rows where points is greater than zero
learning2014 <- 

```

*** =solution
```{r}

# access the dplyr library
library(dplyr)

# select male students
male_students <- filter(learning2014, gender == "M")

# select rows where Points is greater than zero
learning2014 <- filter(learning2014, points > 0)

```

*** =sct
```{r}

test_object("learning2014", incorrect_msg = "Please exclude the observations from learning2014 where points <= 0")

test_error()
success_msg("Awsome!")
```

--- type:NormalExercise lang:r xp:100 skills:1 key:7b821b76a2
## Scatter plots with ggplot2

**ggplot2** is a popular library for creating stunning graphics with R. It has some advantages over the basic plotting system in R, mainly consistent use of function arguments and flexible alteration. ggplot2 is an implementation of Leland Wilkinson's *Grammar of Graphics* — a general scheme for data visualization.

Plots may be created via the convenience function `qplot()` where arguments and defaults are meant to be similar to base R's plot() function. More complex plotting capacity is available via `ggplot()` which exposes the user to more explicit elements of the grammar.

*** =instructions
- instruction

*** =hint
- hint

*** =pre_exercise_code
```{r}

```

*** =sample_code
```{r}
# Use the gglot2 library
library(ggplot2)

# initialize plot coordinates
p <- ggplot(data = learning2014, 
            aes(x = attitude, y = points, col = gender))

# define the visualization (points)
p <- p + geom_point()

# draw the plot
p

# add a regression line
p <- p + geom_smooth(method = "lm")
p

# add a main title
p <- p + ggtitle("students attitude and exam points")
p
```

*** =solution
```{r}
# Use the gglot2 library
library(ggplot2)

# initialize plot coordinates
p <- ggplot(data = learning2014, 
            aes(x = attitude, y = points, col = gender))

# define the visualization (points)
p <- p + geom_point()

# draw the plot
p

# add a regression line
p <- p + geom_smooth(method = "lm")
p

# add a main title
p <- p + ggtitle("students attitude and exam points")
p
```

*** =sct
```{r}

test_function("", args = "",incorrect_msg = "")
test_object("", incorrect_msg = "")
test_output_contains("", incorrect_msg = "")

test_error()
success_msg("Good work!")
```
